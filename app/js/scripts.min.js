function formatClass(t){var a;switch(t){case"1":a="Warrior";break;case"2":a="Mage";break;case"3":a="Archer"}return a}function getTemplate(t,a){$.get("templates/"+t+".html",function(t){a(t)})}var NWarrior=NWarrior||{};NWarrior.Character=function(t){this["class"],this.nickname,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,t,t.world.randomX,t.world.randomY,"player"),this.create()},NWarrior.Character.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Character.prototype.constructor=NWarrior.Character,NWarrior.Character.prototype.create=function(){this.game.add.existing(this),this.frame=1,this.game.physics.arcade.enable(this),this.body.collideWorldBounds=!0,this.game.camera.follow(this),this.cursors=this.game.input.keyboard.createCursorKeys(),gameUtils.walkAnimations(this)},NWarrior.Character.prototype.update=function(){gameUtils.walkCursors(this.cursors,this)};var NWarrior=NWarrior||{};NWarrior.Enemy=function(t){this.type,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,t,t.world.randomX,t.world.randomY,"Enemy"),this.create()},NWarrior.Enemy.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Enemy.prototype.constructor=NWarrior.Enemy,NWarrior.Enemy.prototype.create=function(){};var NWarrior=NWarrior||{},gameWidth=$(".game__wrapper").width(),gameHeight=window.innerHeight;NWarrior.game=function(){this.init()},NWarrior.game.prototype={init:function(){localStorage.getItem("NWarriorToken")||window.location.assign("/"),NWarrior.game=new Phaser.Game(gameWidth,gameHeight,Phaser.AUTO,"phaser"),NWarrior.game.state.add("Boot",NWarrior.Boot),NWarrior.game.state.add("Game",NWarrior.Game),NWarrior.game.state.start("Boot"),this.loadCharacterInfo()},loadCharacterInfo:function(){var t=$(".loader"),a=localStorage.getItem("NWarriorUserID"),e=(config.apiURL+"character/"+a,window.location.search.replace("?characterId=","")),r=$(".stats__wrapper");getTemplate("characterStats",function(a){var i=a,o={};o.token=localStorage.getItem("NWarriorToken"),$.ajax({url:config.apiURL+"characters/"+e,type:"get",data:o,success:function(a){t.removeClass("active");var e=i;e=e.replace("{Nickname}",a.nickname),e=e.replace("{Class}",formatClass(a.characterClass)),e=e.replace("{Strength}",a.strength),e=e.replace("{Constitution}",a.constitution),e=e.replace("{Dexterity}",a.dexterity),e=e.replace("{Intelligence}",a.intelligence),e=e.replace("{Charisma}",a.charisma),e=e.replace("{Stamina}",a.stamina),e=e.replace("{Sleep}",a.sleep),e=e.replace("{Hunger}",a.hunger),r.append(e)},error:function(t,a,e){window.location.assign("/")}})})}};var gameUtils={walkAnimations:function(t){t.animations.add("down",[1,0,2],10,!0),t.animations.add("left",[4,3,5],10,!0),t.animations.add("right",[7,6,8],10,!0),t.animations.add("up",[10,9,11],10,!0)},walk:function(t,a,e){switch(e=e||50,t){case"down":this.lastFrame=1,a.body.velocity.y=e,a.body.velocity.x=0;break;case"up":this.lastFrame=10,a.body.velocity.y=-e,a.body.velocity.x=0;break;case"left":this.lastFrame=4,a.body.velocity.x=-e,a.body.velocity.y=0;break;case"right":this.lastFrame=7,a.body.velocity.y=0,a.body.velocity.x=e;break;case"stop":a.body.velocity.x=0,a.body.velocity.y=0,a.animations.stop()}a.animations.play(t)},walkCursors:function(t,a,e){var r;e=e||400,r=t.left.isDown?"left":t.right.isDown?"right":t.up.isDown?"up":t.down.isDown?"down":"stop",this.walk(r,a,e)},randomWalk:function(t,a){var e=this,a=a||150;setInterval(function(){var r=Math.floor(5*Math.random())+1;switch(r){case 1:e.walk("down",t,a);break;case 2:e.walk("up",t,a);break;case 3:e.walk("left",t,a);break;case 4:e.walk("right",t,a);break;case 5:e.walk("stop",t,a)}},1e3)}},NWarrior=NWarrior||{};NWarrior.Hud=function(t){this.game=t,this.create()},NWarrior.Hud.prototype={create:function(){},turnAudio:function(t){1==this.music.mute?this.music.mute=!1:this.music.mute=!0}};var NWarrior=NWarrior||{};NWarrior.Map=function(t){this.game=t,this.create()},NWarrior.Map.prototype={create:function(){this.map=this.game.add.tilemap("sampleMap");var t=this.map.widthInPixels,a=this.map.heightInPixels;this.game.world.setBounds(0,0,t,a),this.map.addTilesetImage("RPGpack_sheet","tiles"),this.ground=this.map.createLayer("ground"),this.ground.resizeWorld(),this.object=this.map.createLayer("object"),this.object.resizeWorld(),this.water=this.map.createLayer("water"),this.water.resizeWorld()}};var NWarrior=NWarrior||{};NWarrior.Npc=function(t){this.type,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,t,t.world.randomX,t.world.randomY,"npc"),this.create()},NWarrior.Npc.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Npc.prototype.constructor=NWarrior.Character,NWarrior.Npc.prototype.create=function(){this.game.add.existing(this),this.game.physics.arcade.enable(this),this.body.collideWorldBounds=!0,this.frame=4,this.enableBody=!0,gameUtils.walkAnimations(this),gameUtils.randomWalk(this,50)},NWarrior.Npc.prototype.update=function(){};var NWarrior=NWarrior||{};NWarrior.Boot=function(){},NWarrior.Boot.prototype={preload:function(){this.loadingStyle={font:"18px Helvetica",fill:"#fff"},this.loading=this.game.add.text(this.game.world.centerX,this.game.world.centerY,"Carregando...",this.loadingStyle),this.loading.anchor.setTo(.5),this.game.load.spritesheet("player","img/char2.png",31,32),this.game.load.spritesheet("npc","img/char3.png",31,32),this.game.load.tilemap("sampleMap","tiles/sample_map.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("tiles","tiles/RPGpack_sheet.png"),this.game.load.audio("backgroundMusic","audio/RetroMystic.ogg"),this.game.load.image("settings","img/wrench.png"),this.game.load.image("audio","img/audioOn.png")},create:function(){NWarrior.game.state.start("Game")}};var NWarrior=NWarrior||{};NWarrior.Game=function(){this.npcsNumber=10},NWarrior.Game.prototype={create:function(){this.game.time.advancedTiming=!0,this.map=new NWarrior.Map(this.game),this.game.stage.backgroundColor="#00CC66",this.player=new NWarrior.Character(this.game),this.npcs=[],this.npcsGroup=this.game.add.group();for(var t=0;t<this.npcsNumber;t++)this.npcs[t]=new NWarrior.Npc(this.game),this.npcsGroup.add(this.npcs[t]);this.hud=new NWarrior.Hud(this.game)},update:function(){this.game.physics.arcade.collide(this.player,this.npcsGroup)},render:function(){this.game.debug.text(this.game.time.fps||"--",10,640,"#000")}},Boxes=function(t,a){this.trigger=t,this.target=a,this.bindEvents()},Boxes.prototype={bindEvents:function(){var t=this,a=$(this.trigger),e=$(".overlay");a.each(function(){var a=$(this).data("target"),r=$(a);$(this).click(function(a){a.preventDefault(),e.addClass("active"),e.click(function(){e.removeClass("active"),r.removeClass("active")}),t.closeAll(),r.addClass("active")})})},closeAll:function(){var t=$(".formbox");t.each(function(){$(this).removeClass("active")})}},Home=function(){this.formsSelector="form",this.menuNotLogged=$(".menu--not-logged"),this.loggedMenu=$(".menu--logged"),this.notLoggedText=$(".not-logged--text"),this.loggedText=$(".logged--text"),this.loggedInfo=$(".logged--info"),this.bindEvents(),this.checkLogin()},Home.prototype={bindEvents:function(){var t=this,a=$(this.formsSelector);a.each(function(){var a=$(this),e=a.data("target"),r=a.find(".formbox__result");a.submit(function(i){var o=$(this).serializeObject();i.preventDefault(),t.validation(e,a,r)||(t.ajaxPOST(e,r,o),t.cleanForms(a,e,r))})}),$(".logout").click(function(){t.logout()}),$(".character__wrapper").on("click",".character",function(t){var a=$(this).data("character-id");window.location.assign("/game.html?characterId="+a)})},validation:function(t,a,e){var r=!1;switch(t){case"users":var i=a.find("[name=signupPassword]").val(),o=a.find("[name=signupRepeatPassword]").val();i!=o&&(e.html("The passwords must be equal!"),r=!0);break;case"characters":var s=a.find(".remaining-stats").html();0!=s&&(e.html("You must distribute all attributes!"),r=!0)}return r},cleanForms:function(t,a){switch(t.find("input[type=text]:not([readonly])").val(""),a){case"characters":t.find(".stats__input").val(5),t.find(".stats__counter").val(10)}},ajaxPOST:function(t,a,e){var r=this,i=$(".loader"),o=config.apiURL+t;i.addClass("active"),e.token=localStorage.getItem("NWarriorToken"),$.ajax({type:"POST",url:o,data:e,success:function(e){if(i.removeClass("active"),e.failedAuth)return r.logout();switch(t){case"users":r.handleSignUp(e,a);break;case"users/login":r.handleLogin(e,a);break;case"characters":r.handleCharacterCreation(e,a)}},error:function(t,a,e){403==a&&r.logout()}})},handleSignUp:function(t,a){a.html(t.message),t.created&&setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-login"]').click()},500)},handleLogin:function(t,a){a.html(t.message),t.logged&&(setTimeout(function(){$(".overlay").click()},500),this.saveSession(t),this.checkLogin())},saveSession:function(t){localStorage.setItem("NWarriorUserID",t.userId),localStorage.setItem("NWarriorEmail",t.email),localStorage.setItem("NWarriorToken",t.token)},checkLogin:function(){localStorage.getItem("NWarriorToken")?(this.loggedInfo.find("span").html(localStorage.getItem("NWarriorEmail")),this.loggedMenu.show(),this.loggedText.show(),this.loggedInfo.show(),this.menuNotLogged.hide(),this.notLoggedText.hide(),this.setupCharacterCreation(),this.updateCharacterList()):(this.loggedMenu.hide(),this.loggedText.hide(),this.loggedInfo.hide(),this.menuNotLogged.show(),this.notLoggedText.show())},setupCharacterCreation:function(){var t=$('[name="form_create"]'),a=t.find(".stats__group"),e=t.find(".remaining-stats"),r=t.find("[name=characterClass]");r.change(function(){var a=$(this).val();t.find(".create__img img").attr("src","img/classes/"+a+".png")}),a.each(function(){var t=$(this),a=t.find(".stats__btn--plus"),r=t.find(".stats__btn--minus"),i=t.find(".stats__input");a.click(function(t){t.preventDefault();var a=e.html(),r=i.val();a>0&&(r++,i.val(r),a--,e.html(a))}),r.click(function(t){t.preventDefault();var a=e.html(),r=i.val();10>a&&r>5&&(r--,i.val(r),a++,e.html(a))})}),$("[name=userId]").val(localStorage.getItem("NWarriorUserID"))},handleCharacterCreation:function(t,a){a.html(t.message),setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-select"]').click(),a.html(""),$("[name=characterClass]").val(""),$(".create__img img").attr("src","")},500),this.updateCharacterList()},updateCharacterList:function(){var t=this,a=$(".loader"),e=localStorage.getItem("NWarriorUserID"),r=config.apiURL+"characters/byUser/"+e,i=$(".character__wrapper");a.addClass("active"),$(".character__wrapper > *").remove(),getTemplate("characterSelection",function(e){var o=e,s={};s.token=localStorage.getItem("NWarriorToken"),$.ajax({url:r,type:"get",data:s,success:function(t){if(a.removeClass("active"),t.length)for(var e in t){var r=t[e],s=o;s=s.replace("{Nickname}",r.nickname),s=s.replace("{CharacterClass}",formatClass(r.characterClass)),s=s.replace("{Strength}",r.strength),s=s.replace("{Constitution}",r.constitution),s=s.replace("{Dexterity}",r.dexterity),s=s.replace("{Intelligence}",r.intelligence),s=s.replace("{Charisma}",r.charisma),s=s.replace("{ClassImg}",r.characterClass),i.append('<div class="character" data-character-id="'+r._id+'">'+s+"</div>")}else i.append('<p>No characters found! Press "New Character" to create your first!</p>')},error:function(a,e,r){t.logout()}})})},logout:function(){localStorage.clear(),location.reload()}},$.fn.serializeObject=function(){var t={},a=this.serializeArray();return $.each(a,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t};