Boxes=function(e,t){this.trigger=e,this.target=t,this.bindEvents()},Boxes.prototype={bindEvents:function(){var e=this,t=$(this.trigger),a=$(".overlay");t.each(function(){var t=$(this).data("target"),r=$(t);$(this).click(function(t){t.preventDefault(),a.addClass("active"),a.click(function(){a.removeClass("active"),r.removeClass("active")}),e.closeAll(),r.addClass("active")})})},closeAll:function(){var e=$(".formbox");e.each(function(){$(this).removeClass("active")})}},Home=function(){this.formsSelector="form",this.menuNotLogged=$(".menu--not-logged"),this.loggedMenu=$(".menu--logged"),this.notLoggedText=$(".not-logged--text"),this.loggedText=$(".logged--text"),this.loggedInfo=$(".logged--info"),this.bindEvents(),this.checkLogin()},Home.prototype={bindEvents:function(){var e=this,t=$(this.formsSelector);t.each(function(){var t=$(this),a=t.data("target"),r=t.find(".formbox__result");t.submit(function(i){var s=$(this).serializeObject();i.preventDefault(),e.validation(a,t,r)||(e.ajaxPOST(a,r,s),e.cleanForms(t,a,r))})}),$(".logout").click(function(){e.logout()}),$(".character__wrapper").on("click",".character",function(e){var t=$(this).data("character-id");window.location.assign("/game.html?characterId="+t)})},validation:function(e,t,a){var r=!1;switch(e){case"users":var i=t.find("[name=signupPassword]").val(),s=t.find("[name=signupRepeatPassword]").val();i!=s&&(a.html("The passwords must be equal!"),r=!0);break;case"characters":var n=t.find(".remaining-stats").html();0!=n&&(a.html("You must distribute all attributes!"),r=!0)}return r},cleanForms:function(e,t){switch(e.find("input[type=text]:not([readonly])").val(""),t){case"characters":e.find(".stats__input").val(5),e.find(".stats__counter").val(10)}},ajaxPOST:function(e,t,a){var r=this,i=$(".loader"),s=config.apiURL+e;i.addClass("active"),a.token=localStorage.getItem("NWarriorToken"),$.ajax({type:"POST",url:s,data:a,success:function(a){if(i.removeClass("active"),a.failedAuth)return r.logout();switch(e){case"users":r.handleSignUp(a,t);break;case"users/login":r.handleLogin(a,t);break;case"characters":r.handleCharacterCreation(a,t)}},error:function(e,t,a){r.logout()}})},handleSignUp:function(e,t){t.html(e.message),e.created&&setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-login"]').click()},500)},handleLogin:function(e,t){t.html(e.message),e.logged&&(setTimeout(function(){$(".overlay").click()},500),this.saveSession(e),this.checkLogin())},saveSession:function(e){localStorage.setItem("NWarriorUserID",e.userId),localStorage.setItem("NWarriorEmail",e.email),localStorage.setItem("NWarriorToken",e.token)},checkLogin:function(){localStorage.getItem("NWarriorToken")?(this.loggedInfo.find("span").html(localStorage.getItem("NWarriorEmail")),this.loggedMenu.show(),this.loggedText.show(),this.loggedInfo.show(),this.menuNotLogged.hide(),this.notLoggedText.hide(),this.setupCharacterCreation(),this.updateCharacterList()):(this.loggedMenu.hide(),this.loggedText.hide(),this.loggedInfo.hide(),this.menuNotLogged.show(),this.notLoggedText.show())},setupCharacterCreation:function(){var e=$('[name="form_create"]'),t=e.find(".stats__group"),a=e.find(".remaining-stats"),r=e.find("[name=characterClass]");r.change(function(){var t=$(this).val();e.find(".create__img img").attr("src","img/classes/"+t+".png")}),t.each(function(){var e=$(this),t=e.find(".stats__btn--plus"),r=e.find(".stats__btn--minus"),i=e.find(".stats__input");t.click(function(e){e.preventDefault();var t=a.html(),r=i.val();t>0&&(r++,i.val(r),t--,a.html(t))}),r.click(function(e){e.preventDefault();var t=a.html(),r=i.val();10>t&&r>5&&(r--,i.val(r),t++,a.html(t))})}),$("[name=userId]").val(localStorage.getItem("NWarriorUserID"))},handleCharacterCreation:function(e,t){t.html(e.message),setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-select"]').click(),t.html(""),$("[name=characterClass]").val(""),$(".create__img img").attr("src","")},500),this.updateCharacterList()},updateCharacterList:function(){var e=this,t=$(".loader"),a=localStorage.getItem("NWarriorUserID"),r=config.apiURL+"characters/byUser/"+a,i=$(".character__wrapper");t.addClass("active"),$(".character__wrapper > *").remove(),$.get("templates/characterSelection.html",function(a){var s=a,n={};n.token=localStorage.getItem("NWarriorToken"),$.ajax({url:r,type:"get",data:n,success:function(a){if(t.removeClass("active"),a.length)for(var r in a){var n=a[r],o=s;o=o.replace("{Nickname}",n.nickname),o=o.replace("{CharacterClass}",e.formatClass(n.characterClass)),o=o.replace("{Strength}",n.strength),o=o.replace("{Constitution}",n.constitution),o=o.replace("{Dexterity}",n.dexterity),o=o.replace("{Intelligence}",n.intelligence),o=o.replace("{Charisma}",n.charisma),o=o.replace("{ClassImg}",n.characterClass),i.append('<div class="character" data-character-id="'+n._id+'">'+o+"</div>")}else i.append('<p>No characters found! Press "New Character" to create your first!</p>')}})})},formatClass:function(e){var t;switch(e){case"1":t="Warrior";break;case"2":t="Mage";break;case"3":t="Archer"}return t},logout:function(){localStorage.clear(),location.reload()}},$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};