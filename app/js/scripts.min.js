function formatClass(e){var t;switch(console.log(e),e){case 1:t="Warrior";break;case 2:t="Mage";break;case 3:t="Archer"}return t}function getTemplate(e,t){$.get("templates/"+e+".html",function(e){t(e)})}var NWarrior={};NWarrior.Boxes=function(e,t){this.trigger=e,this.target=t,this.bindEvents()},NWarrior.Boxes.prototype={bindEvents:function(){var e=this,t=$(this.trigger),a=$(".overlay");t.each(function(){var t=$(this).data("target"),r=$(t);$(this).click(function(t){t.preventDefault(),a.addClass("active"),a.click(function(){a.removeClass("active"),r.removeClass("active")}),e.closeAll(),r.addClass("active")})})},closeAll:function(){var e=$(".formbox");e.each(function(){$(this).removeClass("active")})}},NWarrior.Home=function(){this.formsSelector="form",this.menuNotLogged=$(".menu--not-logged"),this.loggedMenu=$(".menu--logged"),this.notLoggedText=$(".not-logged--text"),this.loggedText=$(".logged--text"),this.loggedInfo=$(".logged--info"),this.bindEvents(),this.checkLogin()},NWarrior.Home.prototype={bindEvents:function(){var e=this,t=$(this.formsSelector);t.each(function(){var t=$(this),a=t.data("target"),r=t.find(".formbox__result");t.submit(function(i){var o=$(this).serializeObject();i.preventDefault(),e.validation(a,t,r)||(e.ajaxPOST(a,r,o),e.cleanForms(t,a,r))})}),$(".logout").click(function(){e.logout()}),$(".character__wrapper").on("click",".character",function(e){var t=$(this).data("character-id");window.location.assign("/game.html?characterId="+t)})},validation:function(e,t,a){var r=!1;switch(e){case"users":var i=t.find("[name=signupPassword]").val(),o=t.find("[name=signupRepeatPassword]").val();i!=o&&(a.html("The passwords must be equal!"),r=!0);break;case"characters":var s=t.find(".remaining-stats").html();0!=s&&(a.html("You must distribute all attributes!"),r=!0)}return r},cleanForms:function(e,t){switch(e.find("input[type=text]:not([readonly])").val(""),t){case"characters":e.find(".stats__input").val(5),e.find(".stats__counter").val(10)}},ajaxPOST:function(e,t,a){var r=this,i=$(".loader"),o=config.apiURL+e;i.addClass("active"),a.token=localStorage.getItem("NWarriorToken"),$.ajax({type:"POST",url:o,data:a,success:function(a){if(i.removeClass("active"),a.failedAuth)return r.logout();switch(e){case"users":r.handleSignUp(a,t);break;case"users/login":r.handleLogin(a,t);break;case"characters":r.handleCharacterCreation(a,t)}},error:function(e,t,a){403==t&&r.logout()}})},handleSignUp:function(e,t){t.html(e.message),e.created&&setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-login"]').click()},500)},handleLogin:function(e,t){t.html(e.message),e.logged&&(setTimeout(function(){$(".overlay").click()},500),this.saveSession(e),this.checkLogin())},saveSession:function(e){localStorage.setItem("NWarriorUserID",e.userId),localStorage.setItem("NWarriorEmail",e.email),localStorage.setItem("NWarriorToken",e.token)},checkLogin:function(){localStorage.getItem("NWarriorToken")?(this.loggedInfo.find("span").html(localStorage.getItem("NWarriorEmail")),this.loggedMenu.show(),this.loggedText.show(),this.loggedInfo.show(),this.menuNotLogged.hide(),this.notLoggedText.hide(),this.setupCharacterCreation(),this.updateCharacterList()):(this.loggedMenu.hide(),this.loggedText.hide(),this.loggedInfo.hide(),this.menuNotLogged.show(),this.notLoggedText.show())},setupCharacterCreation:function(){var e=$('[name="form_create"]'),t=e.find(".stats__group"),a=e.find(".remaining-stats"),r=e.find("[name=characterClass]");r.change(function(){var t=$(this).val();t?e.find(".create__img img").attr("src","img/classes/"+t+".png"):e.find(".create__img img").attr("src","")}),t.each(function(){var e=$(this),t=e.find(".stats__btn--plus"),r=e.find(".stats__btn--minus"),i=e.find(".stats__input");t.click(function(e){e.preventDefault();var t=a.html(),r=i.val();t>0&&(r++,i.val(r),t--,a.html(t))}),r.click(function(e){e.preventDefault();var t=a.html(),r=i.val();10>t&&r>5&&(r--,i.val(r),t++,a.html(t))})}),$("[name=userId]").val(localStorage.getItem("NWarriorUserID"))},handleCharacterCreation:function(e,t){t.html(e.message),setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-select"]').click(),t.html(""),$("[name=characterClass]").val(""),$(".create__img img").attr("src","")},500),this.updateCharacterList()},updateCharacterList:function(){var e=this,t=$(".loader"),a=localStorage.getItem("NWarriorUserID"),r=config.apiURL+"characters/byUser/"+a,i=$(".character__wrapper");t.addClass("active"),$(".character__wrapper > *").remove(),getTemplate("characterSelection",function(a){var o=a,s={};s.token=localStorage.getItem("NWarriorToken"),$.ajax({url:r,type:"get",data:s,success:function(e){if(t.removeClass("active"),e.length)for(var a in e){var r=e[a],s=o;s=s.replace("{Nickname}",r.nickname),s=s.replace("{CharacterClass}",formatClass(r.characterClass)),s=s.replace("{Strength}",r.strength),s=s.replace("{Constitution}",r.constitution),s=s.replace("{Dexterity}",r.dexterity),s=s.replace("{Intelligence}",r.intelligence),s=s.replace("{Charisma}",r.charisma),s=s.replace("{ClassImg}",r.characterClass),i.append('<div class="character" data-character-id="'+r._id+'">'+s+"</div>")}else i.append('<p>No characters found! Press "New Character" to create your first!</p>')},error:function(t,a,r){e.logout()}})})},logout:function(){localStorage.clear(),location.reload()}},$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},NWarrior.Character=function(e){this["class"],this.nickname,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,e,e.world.randomX,e.world.randomY,"player"),this.create()},NWarrior.Character.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Character.prototype.constructor=NWarrior.Character,NWarrior.Character.prototype.create=function(){this.game.add.existing(this),this.frame=1,this.game.physics.arcade.enable(this),this.body.collideWorldBounds=!0,this.game.camera.follow(this),this.cursors=this.game.input.keyboard.createCursorKeys(),gameUtils.walkAnimations(this)},NWarrior.Character.prototype.update=function(){gameUtils.walkCursors(this.cursors,this)},NWarrior.Enemy=function(e){this.type,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,e,e.world.randomX,e.world.randomY,"Enemy"),this.create()},NWarrior.Enemy.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Enemy.prototype.constructor=NWarrior.Enemy,NWarrior.Enemy.prototype.create=function(){},NWarrior.game=function(){this.init()},NWarrior.game.prototype={init:function(){localStorage.getItem("NWarriorToken")||window.location.assign("/"),this.gameWidth=$(".game__wrapper").width(),this.gameHeight=window.innerHeight,NWarrior.game=new Phaser.Game(this.gameWidth,this.gameHeight,Phaser.AUTO,"phaser"),NWarrior.game.state.add("Boot",NWarrior.Boot),NWarrior.game.state.add("Game",NWarrior.Game),NWarrior.game.state.start("Boot"),this.loadCharacterInfo()},loadCharacterInfo:function(){var e=$(".loader"),t=localStorage.getItem("NWarriorUserID"),a=(config.apiURL+"character/"+t,window.location.search.replace("?characterId=","")),r=$(".stats__wrapper");getTemplate("characterStats",function(t){var i=t,o={};o.token=localStorage.getItem("NWarriorToken"),$.ajax({url:config.apiURL+"characters/"+a,type:"get",data:o,success:function(t){e.removeClass("active");var a=i;a=a.replace("{Nickname}",t.nickname),a=a.replace("{Class}",formatClass(t.characterClass)),a=a.replace(new RegExp("{Strength}","g"),t.strength),a=a.replace(new RegExp("{StrengthXP}","g"),t.strengthXP),a=a.replace(new RegExp("{Constitution}","g"),t.constitution),a=a.replace(new RegExp("{ConstitutionXP}","g"),t.constitutionXP),a=a.replace(new RegExp("{Dexterity}","g"),t.dexterity),a=a.replace(new RegExp("{DexterityXP}","g"),t.dexterityXP),a=a.replace(new RegExp("{Intelligence}","g"),t.intelligence),a=a.replace(new RegExp("{IntelligenceXP}","g"),t.intelligenceXP),a=a.replace(new RegExp("{Charisma}","g"),t.charisma),a=a.replace(new RegExp("{CharismaXP}","g"),t.charismaXP),a=a.replace(new RegExp("{Health}","g"),t.health),a=a.replace(new RegExp("{CurrentHealth}","g"),t.currentHealth),a=a.replace(new RegExp("{Mana}","g"),t.mana),a=a.replace(new RegExp("{CurrentMana}","g"),t.currentMana),a=a.replace(new RegExp("{Stamina}","g"),t.stamina),a=a.replace(new RegExp("{CurrentStamina}","g"),t.currentStamina),a=a.replace(new RegExp("{Sleep}","g"),t.sleep),a=a.replace(new RegExp("{CurrentSleep}","g"),t.currentSleep),a=a.replace(new RegExp("{Hunger}","g"),t.hunger),a=a.replace(new RegExp("{CurrentHunger}","g"),t.currentHunger),r.append(a)},error:function(e,t,a){window.location.assign("/")}})})}};var gameUtils={walkAnimations:function(e){e.animations.add("down",[1,0,2],10,!0),e.animations.add("left",[4,3,5],10,!0),e.animations.add("right",[7,6,8],10,!0),e.animations.add("up",[10,9,11],10,!0)},walk:function(e,t,a){switch(a=a||50,e){case"down":this.lastFrame=1,t.body.velocity.y=a,t.body.velocity.x=0;break;case"up":this.lastFrame=10,t.body.velocity.y=-a,t.body.velocity.x=0;break;case"left":this.lastFrame=4,t.body.velocity.x=-a,t.body.velocity.y=0;break;case"right":this.lastFrame=7,t.body.velocity.y=0,t.body.velocity.x=a;break;case"stop":t.body.velocity.x=0,t.body.velocity.y=0,t.animations.stop()}t.animations.play(e)},walkCursors:function(e,t,a){var r;a=a||400,r=e.left.isDown?"left":e.right.isDown?"right":e.up.isDown?"up":e.down.isDown?"down":"stop",this.walk(r,t,a)},randomWalk:function(e,t){var a=this,t=t||150;setInterval(function(){var r=Math.floor(5*Math.random())+1;switch(r){case 1:a.walk("down",e,t);break;case 2:a.walk("up",e,t);break;case 3:a.walk("left",e,t);break;case 4:a.walk("right",e,t);break;case 5:a.walk("stop",e,t)}},1e3)}};NWarrior.Hud=function(e){this.game=e,this.create()},NWarrior.Hud.prototype={create:function(){},turnAudio:function(e){1==this.music.mute?this.music.mute=!1:this.music.mute=!0}},NWarrior.Map=function(e){this.game=e,this.create()},NWarrior.Map.prototype={create:function(){this.map=this.game.add.tilemap("sampleMap");var e=this.map.widthInPixels,t=this.map.heightInPixels;this.game.world.setBounds(0,0,e,t),this.map.addTilesetImage("RPGpack_sheet","tiles"),this.ground=this.map.createLayer("Ground"),this.ground.resizeWorld(),this.object=this.map.createLayer("Objects"),this.object.resizeWorld()}},NWarrior.Npc=function(e){this.type,this.str,this.con,this.dex,this["int"],this.cha,this.hp,this.mana,this.stamina,this.hunger,this.sleep,Phaser.Sprite.call(this,e,e.world.randomX,e.world.randomY,"npc"),this.create()},NWarrior.Npc.prototype=Object.create(Phaser.Sprite.prototype),NWarrior.Npc.prototype.constructor=NWarrior.Character,NWarrior.Npc.prototype.create=function(){this.game.add.existing(this),this.game.physics.arcade.enable(this),this.body.collideWorldBounds=!0,this.frame=4,this.enableBody=!0,gameUtils.walkAnimations(this),gameUtils.randomWalk(this,50)},NWarrior.Npc.prototype.update=function(){},NWarrior.Boot=function(){},NWarrior.Boot.prototype={preload:function(){this.loadingStyle={font:"18px Helvetica",fill:"#fff"},this.loading=this.game.add.text(this.game.world.centerX,this.game.world.centerY,"Carregando...",this.loadingStyle),this.loading.anchor.setTo(.5),this.game.load.spritesheet("player","img/char2.png",31,32),this.game.load.spritesheet("npc","img/char3.png",31,32),this.game.load.tilemap("sampleMap","tiles/sample_map3.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("tiles","tiles/RPGpack_sheet.png"),this.game.load.audio("backgroundMusic","audio/RetroMystic.ogg"),this.game.load.image("settings","img/wrench.png"),this.game.load.image("audio","img/audioOn.png")},create:function(){NWarrior.game.state.start("Game")}},NWarrior.Game=function(){this.npcsNumber=10},NWarrior.Game.prototype={create:function(){this.game.time.advancedTiming=!0,this.map=new NWarrior.Map(this.game),this.game.stage.backgroundColor="#00CC66",this.player=new NWarrior.Character(this.game),this.npcs=[],this.npcsGroup=this.game.add.group();for(var e=0;e<this.npcsNumber;e++)this.npcs[e]=new NWarrior.Npc(this.game),this.npcsGroup.add(this.npcs[e]);this.hud=new NWarrior.Hud(this.game)},update:function(){this.game.physics.arcade.collide(this.player,this.npcsGroup)},render:function(){this.game.debug.text(this.game.time.fps||"--",10,640,"#000")}};