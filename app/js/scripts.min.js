Boxes=function(e,t){this.trigger=e,this.target=t,this.bindEvents()},Boxes.prototype={bindEvents:function(){var e=this,t=$(this.trigger),a=$(".overlay");t.each(function(){var t=$(this).data("target"),s=$(t);$(this).click(function(t){t.preventDefault(),a.addClass("active"),a.click(function(){a.removeClass("active"),s.removeClass("active")}),e.closeAll(),s.addClass("active")})})},closeAll:function(){var e=$(".formbox");e.each(function(){$(this).removeClass("active")})}},Home=function(){this.apiURL="http://localhost:8080/",this.formsSelector="form",this.menuNotLogged=$(".menu--not-logged"),this.loggedMenu=$(".menu--logged"),this.notLoggedText=$(".not-logged--text"),this.loggedText=$(".logged--text"),this.loggedInfo=$(".logged--info"),this.bindEvents(),this.checkLogin()},Home.prototype={bindEvents:function(){var e=this,t=$(this.formsSelector);t.each(function(){var t=$(this),a=t.data("target"),s=t.find(".formbox__result");t.submit(function(i){var n=$(this).serializeObject();i.preventDefault(),e.validation(a,t,s)||(e.ajaxPOST(a,s,n),e.cleanForms(t,a,s))})}),$(".logout").click(function(){e.logout()}),$(".character__wrapper").on("click",".character",function(e){var t=$(this).data("character-id");window.location.assign("/game.html?characterId="+t)})},validation:function(e,t,a){var s=!1;switch(e){case"users":var i=t.find("[name=signupPassword]").val(),n=t.find("[name=signupRepeatPassword]").val();i!=n&&(a.html("The passwords must be equal!"),s=!0);break;case"characters":var r=t.find(".remaining-stats").html();0!=r&&(a.html("You must distribute all attributes!"),s=!0)}return s},cleanForms:function(e,t){switch(e.find("input[type=text]:not([readonly])").val(""),t){case"characters":e.find(".stats__input").val(5),e.find(".stats__counter").val(10)}},ajaxPOST:function(e,t,a){var s=this,i=$(".loader"),n=s.apiURL+e;i.addClass("active"),a.token=sessionStorage.getItem("token"),$.ajax({type:"POST",url:n,data:a,success:function(a){if(i.removeClass("active"),a.failedAuth)return s.logout();switch(e){case"users":s.handleSignUp(a,t);break;case"users/login":s.handleLogin(a,t);break;case"characters":s.handleCharacterCreation(a,t)}},error:function(e,t,a){s.logout()}})},handleSignUp:function(e,t){t.html(e.message),e.created&&setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-login"]').click()},500)},handleLogin:function(e,t){t.html(e.message),e.logged&&(setTimeout(function(){$(".overlay").click()},500),this.saveSession(e),this.checkLogin())},saveSession:function(e){sessionStorage.setItem("userID",e.userId),sessionStorage.setItem("email",e.email),sessionStorage.setItem("token",e.token)},checkLogin:function(){sessionStorage.getItem("userID")?(this.loggedInfo.find("span").html(sessionStorage.getItem("email")),this.loggedMenu.show(),this.loggedText.show(),this.loggedInfo.show(),this.menuNotLogged.hide(),this.notLoggedText.hide(),this.setupCharacterCreation(),this.updateCharacterList()):(this.loggedMenu.hide(),this.loggedText.hide(),this.loggedInfo.hide(),this.menuNotLogged.show(),this.notLoggedText.show())},setupCharacterCreation:function(){var e=$('[name="form_create"]'),t=e.find(".stats__group"),a=e.find(".remaining-stats"),s=e.find("[name=characterClass]");s.change(function(){var t=$(this).val();e.find(".create__img img").attr("src","img/classes/"+t+".png")}),t.each(function(){var e=$(this),t=e.find(".stats__btn--plus"),s=e.find(".stats__btn--minus"),i=e.find(".stats__input");t.click(function(e){e.preventDefault();var t=a.html(),s=i.val();t>0&&(s++,i.val(s),t--,a.html(t))}),s.click(function(e){e.preventDefault();var t=a.html(),s=i.val();10>t&&s>5&&(s--,i.val(s),t++,a.html(t))})}),$("[name=userId]").val(sessionStorage.getItem("userID"))},handleCharacterCreation:function(e,t){t.html(e.message),setTimeout(function(){$(".overlay").click(),$('[data-target="#formbox-select"]').click(),t.html(""),$("[name=characterClass]").val(""),$(".create__img img").attr("src","")},500),this.updateCharacterList()},updateCharacterList:function(){var e=this,t=$(".loader"),a=sessionStorage.getItem("userID"),s=e.apiURL+"characters/byUser/"+a,i=$(".character__wrapper");t.addClass("active"),$(".character__wrapper > *").remove(),$.get("templates/characterSelection.html",function(a){var n=a,r={};r.token=sessionStorage.getItem("token"),$.ajax({url:s,type:"get",data:r,success:function(a){if(t.removeClass("active"),a.length)for(var s in a){var r=a[s],o=n;o=o.replace("{Nickname}",r.nickname),o=o.replace("{CharacterClass}",e.formatClass(r.characterClass,r.gender)),o=o.replace("{Strength}",r.strength),o=o.replace("{Constitution}",r.constitution),o=o.replace("{Dexterity}",r.dexterity),o=o.replace("{Intelligence}",r.intelligence),o=o.replace("{Charisma}",r.charisma),o=o.replace("{ClassImg}",r.characterClass),i.append('<div class="character" data-character-id="'+r._id+'">'+o+"</div>")}else i.append('<p>No characters found! Press "New Character" to create your first!</p>')}})})},formatClass:function(e,t){var a,t="F"==t?"Female":"Male";switch(e){case"1":a="Warrior";break;case"2":a="Mage";break;case"3":a="Archer"}return t+" "+a},logout:function(){sessionStorage.clear(),location.reload()}},$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};